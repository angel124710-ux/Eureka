--[[
    Universal Lock Controller para TSB
    - Carrega o script original ofuscado PRIMEIRO
    - PC: Teclas P (cam lock) | L (character lock)
    - Mobile: Bot√£o √∫nico com switch P/L
]]

-- Vari√°veis de estado (ser√£o atualizadas pelo script original)
_G.CharLockEnabled = _G.CharLockEnabled or false
_G.CamLockEnabled = _G.CamLockEnabled or false

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local pGui = player:WaitForChild("PlayerGui")

-- ==============================================
-- 1. CARREGAR O SCRIPT ORIGINAL (OBRIGAT√ìRIO)
-- ==============================================
local function loadOriginalScript()
    local success, result = pcall(function()
        -- O link que voc√™ forneceu
        local scriptContent = game:HttpGet("https://rawscripts.net/raw/The-Strongest-Battlegrounds-Tsb-Op-Silent-And-LockOn-44541")
        local func = loadstring(scriptContent)
        if func then
            func() -- Executa o script ofuscado
            print("‚úÖ Script original carregado com sucesso!")
            return true
        end
    end)
    
    if not success then
        warn("‚ùå Falha ao carregar o script original. O script pode n√£o funcionar.")
        return false
    end
    return true
end

-- Carrega o script original imediatamente
local originalLoaded = loadOriginalScript()

-- ==============================================
-- 2. DETECTAR PLATAFORMA E LIMPAR UI ANTIGA
-- ==============================================
local function isMobile()
    return UserInputService.TouchEnabled and not UserInputService.MouseEnabled
end

local function cleanup()
    local old = pGui:FindFirstChild("MobileLockController")
    if old then old:Destroy() end
end

-- ==============================================
-- 3. SE FOR MOBILE, CRIAR UI
-- ==============================================
if isMobile() then
    cleanup()
    
    -- Localizar o bot√£o original (que o script ofuscado cria)
    local originalButton = nil
    local contextFrame = pGui:FindFirstChild("ContextActionGui") and 
                         pGui.ContextActionGui:FindFirstChild("ContextButtonFrame")
    
    if contextFrame then
        local buttons = contextFrame:GetChildren()
        table.sort(buttons, function(a, b) return a.Name < b.Name end)
        -- O script original destr√≥i 2 bot√µes, sobra 1
        originalButton = buttons[1]
    end
    
    -- Criar nossa UI
    local sg = Instance.new("ScreenGui")
    sg.Name = "MobileLockController"
    sg.Parent = pGui
    sg.ResetOnSpawn = false
    sg.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    sg.IgnoreGuiInset = true
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Parent = sg
    mainFrame.Size = UDim2.new(0, 200, 0, 120)
    mainFrame.Position = UDim2.new(0.5, -100, 0.8, -60)
    mainFrame.BackgroundTransparency = 1
    mainFrame.Active = true
    mainFrame.Draggable = true
    
    -- Bot√£o grande (c√≥pia do original)
    local bigButton = Instance.new("TextButton")
    bigButton.Parent = mainFrame
    bigButton.Size = UDim2.new(0, 80, 0, 80)
    bigButton.Position = UDim2.new(0, 10, 0, 10)
    bigButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    bigButton.Text = "LOCK"
    bigButton.TextColor3 = Color3.new(1,1,1)
    bigButton.Font = Enum.Font.GothamBold
    bigButton.TextSize = 16
    bigButton.AutoButtonColor = false
    
    -- Se o original existir, copia a apar√™ncia
    if originalButton then
        bigButton.BackgroundColor3 = originalButton.BackgroundColor3
        bigButton.Text = originalButton.Text
        bigButton.Font = originalButton.Font
        bigButton.TextSize = originalButton.TextSize
        bigButton.Size = originalButton.Size
        bigButton.Position = originalButton.Position
        originalButton.Visible = false
    end
    
    local bigCorner = Instance.new("UICorner")
    bigCorner.Parent = bigButton
    bigCorner.CornerRadius = UDim.new(0, 12)
    
    -- Switch P/L
    local mode = "L"
    local switchFrame = Instance.new("Frame")
    switchFrame.Parent = mainFrame
    switchFrame.Size = UDim2.new(0, 40, 0, 40)
    switchFrame.Position = UDim2.new(0, 100, 0, 30)
    switchFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    switchFrame.BackgroundTransparency = 0.2
    switchFrame.Active = true
    switchFrame.Draggable = true
    
    local switchCorner = Instance.new("UICorner")
    switchCorner.Parent = switchFrame
    switchCorner.CornerRadius = UDim.new(1, 0)
    
    local switchButton = Instance.new("TextButton")
    switchButton.Parent = switchFrame
    switchButton.Size = UDim2.new(1, 0, 1, 0)
    switchButton.BackgroundTransparency = 1
    switchButton.Text = mode
    switchButton.TextColor3 = Color3.fromRGB(0, 255, 255)
    switchButton.Font = Enum.Font.GothamBold
    switchButton.TextSize = 20
    switchButton.AutoButtonColor = false
    
    -- Atualizar cor do bot√£o baseado no modo e estado
    local function updateButtonColor()
        if mode == "L" then
            bigButton.BackgroundColor3 = _G.CharLockEnabled and 
                Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
        else
            bigButton.BackgroundColor3 = _G.CamLockEnabled and 
                Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
        end
    end
    
    spawn(function()
        while true do
            task.wait(0.1)
            updateButtonColor()
        end
    end)
    
    -- Evento do switch
    switchButton.MouseButton1Click:Connect(function()
        mode = (mode == "L") and "P" or "L"
        switchButton.Text = mode
        updateButtonColor()
    end)
    
    -- Evento do bot√£o grande
    bigButton.MouseButton1Click:Connect(function()
        if mode == "L" then
            _G.CharLockEnabled = not _G.CharLockEnabled
            if _G.CharacterLock then
                _G.CharacterLock(_G.CharLockEnabled)
            end
        else
            _G.CamLockEnabled = not _G.CamLockEnabled
            if _G.CameraLock then
                _G.CameraLock(_G.CamLockEnabled)
            end
        end
        updateButtonColor()
    end)
    
    if originalButton then
        originalButton.Visible = false
    end
    
    print("üì± Mobile UI carregada. Use o switch P/L.")
    
else
    -- ==============================================
    -- MODO PC: Apenas teclas
    -- ==============================================
    UserInputService.InputBegan:Connect(function(input, gpe)
        if gpe then return end
        
        if input.KeyCode == Enum.KeyCode.P then
            _G.CamLockEnabled = not _G.CamLockEnabled
            if _G.CameraLock then
                _G.CameraLock(_G.CamLockEnabled)
            end
            print("üì∑ Camera Lock:", _G.CamLockEnabled and "ON" or "OFF")
            
        elseif input.KeyCode == Enum.KeyCode.L then
            _G.CharLockEnabled = not _G.CharLockEnabled
            if _G.CharacterLock then
                _G.CharacterLock(_G.CharLockEnabled)
            end
            print("üë§ Character Lock:", _G.CharLockEnabled and "ON" or "OFF")
        end
    end)
    
    print("üíª PC mode: Pressione P (Cam) ou L (Character)")
end

-- Recriar UI ao renascer (mobile)
if isMobile() then
    player.CharacterAdded:Connect(function()
        task.wait(2)
        cleanup()
        -- Recriar UI...
    end)
end
